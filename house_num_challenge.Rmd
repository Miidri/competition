---
title: "house_num_challenge"
author: "Midori Omura"
date: "2018/10/17"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r set_up}
#パッケージのインストールと読み込み
#持ってないパッケージはインストールする
targetPackages <- c('knitr','DBI','RPostgreSQL','tidyverse',"reshape2","lubridate","dbplot","DT") 
newPackages <- targetPackages[!(targetPackages %in% installed.packages()[,"Package"])]
if(length(newPackages)) install.packages(newPackages, repos = "http://cran.us.r-project.org")
for(package in targetPackages) library(package, character.only = T)



drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv,dbname="video",host="localhost",port=5431,
                 user="b4" ,password="takayuki")
```


```{r get_data}
play <- con %>% 
  tbl(from = dbplyr::in_schema("processed", "tv_play_p_cv")) 
orgn <- con %>% 
  tbl(from = dbplyr::in_schema("processed", "tv_orgn_p_cv"))
prof <- con %>% 
  tbl(from = dbplyr::in_schema("processed", "profiledata"))


#play1<- dbGetQuery(con,"SELECT * FROM processed.tv_play_p_cv")
#orgn1 <- dbGetQuersy(con,"SELECT * FROM processed.tv_orgn_p_cv")
#prof1 <- dbGetQuery(con,"SELECT * FROM prcessed.profiledata")

```

###CM時点データ
***


```{r}
houseNo <- dbGetQuery(con,"SELECT  
	distinct(house_num),
	count(house_num)
FROM
	processed.tv_orgn_p_cv
group by (house_num)")

head(houseNo)
```

```{r}
houseDate <- dbGetQuery(con,"SELECT  
	distinct(br_date),
	count(br_date)
FROM
	processed.tv_orgn_p_cv
group by (br_date)")

head(houseDate)

```



houseDetail <- dbGetQuery(con,"
SELECT
	distinct(house_num),
	max(br_date),
	min(br_date),
	count(distinct(br_date))

FROM
	processed.tv_orgn_p_cv
group by (house_num)")


head(houseDetail)


